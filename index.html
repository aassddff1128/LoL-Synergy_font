<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Synergy</title>
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>LoL Synergy</h1>
        <p>Guess the synergy with the random champion!</p>

        <div>
            <button onclick="fetchRandomChampion()">Get Random Champion</button>
        </div>

        <p id="randomChampion"></p>

        <div>
            <label for="champion">Enter your Champion:</label>
            <input type="text" id="champion" name="champion" oninput="searchChampion()">
        </div>

        <ul id="championList" style="display:none;"></ul>

        <button onclick="calculateSynergy()">Calculate Synergy</button>

        <p id="result"></p>

        <div>
            <h2>Champion History</h2>
            <ul id="historyList"></ul>
        </div>
    </div>

    <script>
        let randomChampion = '';
        const history = [];

        // 랜덤 챔피언을 서버에서 가져오기
        function fetchRandomChampion() {
            fetch('/api/random_champion')
            .then(response => response.json())
            .then(data => {
                randomChampion = data.random_champion;
                document.getElementById('randomChampion').textContent = `Random Champion: ${randomChampion}`;
            });
        }

        // 유저가 입력한 챔피언을 기반으로 서버에서 검색
        function searchChampion() {
            const query = document.getElementById('champion').value;

            if (query.length > 1) {
                fetch(`/api/champion_search?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    const championList = document.getElementById('championList');
                    championList.innerHTML = '';  // 이전 목록을 지움
                    data.forEach(champion => {
                        const li = document.createElement('li');
                        li.textContent = champion;
                        li.onclick = () => selectChampion(champion);
                        championList.appendChild(li);
                    });
                    championList.style.display = 'block';
                });
            } else {
                document.getElementById('championList').style.display = 'none';
            }
        }

        // 클릭한 챔피언 이름을 입력 필드에 넣기
        function selectChampion(champion) {
            document.getElementById('champion').value = champion;
            document.getElementById('championList').style.display = 'none';
        }

        // 연관성 점수 계산 요청
        function calculateSynergy() {
            const champ = document.getElementById('champion').value;

            fetch('/api/similarity', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    champion: champ
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.similarity_score !== undefined) {
                    document.getElementById('result').textContent = `Your Champion: ${data.user_champion}, Similarity Score: ${data.similarity_score}`;
                    updateHistory(data.user_champion, data.similarity_score);
                } else {
                    document.getElementById('result').textContent = 'Error: ' + data.error;
                }
            });
        }

        // 챔피언 히스토리 업데이트
        function updateHistory(champion, score) {
            history.push({ champion, score });
            history.sort((a, b) => b.score - a.score); // 점수 기준으로 정렬

            const historyList = document.getElementById('historyList');
            historyList.innerHTML = ''; // 이전 목록 초기화
            history.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.champion} - Score: ${item.score}`;
                historyList.appendChild(li);
            });
        }
    </script>
</body>
</html>
